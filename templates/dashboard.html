{% extends "base.html" %}

{% block title %}Domain Monitoring Dashboard{% endblock %}

{% block add_domain_button %}
<button class="nav-link btn btn-link text-light" data-bs-toggle="modal" data-bs-target="#addDomainModal">
    <i class="fas fa-plus"></i> Add
</button>
{% endblock %}

{% block content %}
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-0">
                        <!-- <i class="fas fa-tachometer-alt"></i> Domain Monitoring Dashboard -->
                    </h1>
                    <!-- <p class="mb-0 mt-2">Monitor your domains' health and SSL certificates</p> -->
                </div><br>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-globe fa-2x text-primary mb-2"></i>
                        <h5 class="card-title">Total Domains</h5>
                        <h3 class="text-primary" id="totalDomains">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                        <h5 class="card-title">Online</h5>
                        <h3 class="text-success" id="onlineDomains">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-exclamation-triangle fa-2x text-warning mb-2"></i>
                        <h5 class="card-title">SSL Expiring</h5>
                        <h3 class="text-warning" id="sslExpiring">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-times-circle fa-2x text-danger mb-2"></i>
                        <h5 class="card-title">Offline</h5>
                        <h3 class="text-danger" id="offlineDomains">0</h3>
                    </div>
                </div>
            </div>
        </div>
        <!-- show pending domains in a long card as Pending Domains: <number>.-->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Pending Domains: <span id="pendingDomains">0</span></h5>
                <small class="text-muted">Pending verification</small>  
            </div>
        </div>
        <br>
        
        <!-- Domains Table -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-list"></i> Domain Status
                </h5>
                <div>
                    <button class="btn btn-outline-primary btn-sm" onclick="checkURLs()" title="Check All Domains">
                        <i class="fa fa-check"></i> Check All
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" onclick="sortTable(this,'domain')" style="cursor: pointer;">
                                    <i class="fas fa-globe"></i> Domain Name <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" onclick="sortTable(this,'status')" style="cursor: pointer;">
                                    <i class="fas fa-heartbeat"></i> Liveness Status <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" onclick="sortTable(this,'ssl_expiration')" style="cursor: pointer;">
                                    <i class="fas fa-calendar-alt"></i> SSL Expiration Date <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" onclick="sortTable(this,'ssl_issuer')" style="cursor: pointer;">
                                    <i class="fas fa-certificate"></i> SSL Issuer <span class="sort-arrow"></span>
                                </th>
                                <th scope="col">
                                    <i class="fas fa-cog"></i> Actions
                                </th>
                                <th scope="col" onclick="sortTable(this,'last_chk')" style="cursor: pointer;">
                                    Last Check <span class="sort-arrow"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="domainsTableBody">
                        <!-- user data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-5" style="display: none;">
            <i class="fas fa-globe fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No domains to monitor</h4>
            <p class="text-muted">Add your first domain to start monitoring</p>
            <button class="btn btn-add-domain" data-bs-toggle="modal" data-bs-target="#addDomainModal">
                <i class="fas fa-plus"></i> Add Domain
            </button>
        </div>
    </div><br>

{% endblock %}

{% block add_domain_modal %}
    <!-- Add Domain Modal -->
    <div class="modal fade" id="addDomainModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus"></i> Add Domains
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Add Method Selection -->
                    <div class="mb-4">
                        <label class="form-label">Choose how to add domains:</label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card h-100" style="cursor: pointer;" onclick="selectAddMethod('single')">
                                    <div class="card-body text-center">
                                        <i class="fas fa-globe fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Single Domain</h6>
                                        <p class="card-text small text-muted">Add one domain manually</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100" style="cursor: pointer;" onclick="selectAddMethod('file')">
                                    <div class="card-body text-center">
                                        <i class="fas fa-file-upload fa-2x text-success mb-2"></i>
                                        <h6 class="card-title">Upload File</h6>
                                        <p class="card-text small text-muted">Upload multiple domains from file</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Single Domain Form -->
                    <div id="singleDomainForm" style="display: none;">
                        <form id="addSingleDomainForm">
                            <div class="mb-3">
                                <label for="domainName" class="form-label">Domain Name</label>
                                <input type="text" class="form-control" id="domainName" placeholder="example.com" required>
                                <div class="form-text">Enter a single domain name (e.g., example.com)</div>
                            </div>
                        </form>
                    </div>

                    <!-- File Upload Form -->
                    <div id="fileUploadForm" style="display: none;">
                        <form id="addFileUploadForm">
                            <div class="mb-3">
                                <label for="domainFile" class="form-label">Upload Domain File</label>
                                <input type="file" class="form-control" id="domainFile" accept=".txt,.csv" required>
                                <div class="form-text">
                                    Upload a text file (.txt) or CSV file (.csv) with one domain per line
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>File Format:</strong> Each line should contain one domain name (e.g., example.com)
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-add-domain" id="addDomainBtn" onclick="addDomain()" style="display: none;">
                        <i class="fas fa-plus"></i> Add Domain
                    </button>
                    <button type="button" class="btn btn-add-domain" id="uploadFileBtn" onclick="uploadFile()" style="display: none;">
                        <i class="fas fa-upload"></i> Upload File
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/dashboard-controller.js"></script>
{% endblock %}
